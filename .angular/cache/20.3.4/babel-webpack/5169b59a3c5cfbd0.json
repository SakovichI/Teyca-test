{"ast":null,"code":"import { __decorate } from 'tslib';\nimport * as i0 from '@angular/core';\nimport { EventEmitter, ChangeDetectorRef, Component, ChangeDetectionStrategy, Optional, Inject, Self, Input, Output, HostListener, NgModule } from '@angular/core';\nimport * as i4 from '@taiga-ui/cdk';\nimport { TuiMonth, ALWAYS_FALSE_HANDLER, TUI_FIRST_DAY, TUI_LAST_DAY, tuiWatch, tuiIsString, TuiDayRange, tuiNullableSame, tuiObjectFromEntries, TuiDestroyService, tuiPure, TuiMapperPipeModule, TuiPreventDefaultModule } from '@taiga-ui/cdk';\nimport * as i2 from '@taiga-ui/core';\nimport { TUI_DEFAULT_MARKER_HANDLER, TUI_COMMON_ICONS, TuiCalendarModule, TuiSvgModule, TuiDataListModule } from '@taiga-ui/core';\nimport { MAX_DAY_RANGE_LENGTH_MAPPER } from '@taiga-ui/kit/constants';\nimport { TUI_CALENDAR_DATE_STREAM, TUI_OTHER_DATE_TEXT } from '@taiga-ui/kit/tokens';\nimport { takeUntil } from 'rxjs/operators';\nimport * as i1 from '@taiga-ui/kit/internal/primitive-calendar-range';\nimport { TuiPrimitiveCalendarRangeModule } from '@taiga-ui/kit/internal/primitive-calendar-range';\nimport * as i3 from '@angular/common';\nimport { CommonModule } from '@angular/common';\nimport * as i5 from 'rxjs';\nconst _c0 = (a0, a1, a2, a3) => [a0, a1, a2, a3, false];\nconst _c1 = (a0, a1, a2, a3) => [a0, a1, a2, a3, true];\nconst _c2 = (a0, a1, a2, a3, a4, a5) => [a0, a1, a2, a3, a4, a5];\nfunction TuiCalendarRangeComponent_tui_primitive_calendar_range_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tui-primitive-calendar-range\", 2);\n    i0.ɵɵpipe(1, \"tuiMapper\");\n    i0.ɵɵpipe(2, \"tuiMapper\");\n    i0.ɵɵpipe(3, \"tuiMapper\");\n    i0.ɵɵlistener(\"dayClick\", function TuiCalendarRangeComponent_tui_primitive_calendar_range_0_Template_tui_primitive_calendar_range_dayClick_0_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onDayClick($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"defaultViewedMonthFirst\", ctx_r1.defaultViewedMonth)(\"defaultViewedMonthSecond\", i0.ɵɵpipeBind3(1, 7, ctx_r1.defaultViewedMonth, ctx_r1.monthOffset, 1))(\"disabledItemHandler\", ctx_r1.calculatedDisabledItemHandler)(\"markerHandler\", ctx_r1.markerHandler)(\"max\", i0.ɵɵpipeBindV(2, 11, i0.ɵɵpureFunction4(23, _c0, ctx_r1.computedMax, ctx_r1.maxLengthMapper, ctx_r1.value, ctx_r1.maxLength)))(\"min\", i0.ɵɵpipeBindV(3, 17, i0.ɵɵpureFunction4(28, _c1, ctx_r1.computedMin, ctx_r1.maxLengthMapper, ctx_r1.value, ctx_r1.maxLength)))(\"value\", ctx_r1.value);\n  }\n}\nfunction TuiCalendarRangeComponent_ng_template_1_button_5_tui_svg_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tui-svg\", 9);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"src\", ctx_r1.icons.check);\n  }\n}\nfunction TuiCalendarRangeComponent_ng_template_1_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function TuiCalendarRangeComponent_ng_template_1_button_5_Template_button_click_0_listener() {\n      const item_r5 = i0.ɵɵrestoreView(_r4).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onItemSelect(item_r5));\n    })(\"keydown.enter.prevent\", function TuiCalendarRangeComponent_ng_template_1_button_5_Template_button_keydown_enter_prevent_0_listener() {\n      const item_r5 = i0.ɵɵrestoreView(_r4).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onItemSelect(item_r5));\n    })(\"keydown.space.prevent\", function TuiCalendarRangeComponent_ng_template_1_button_5_Template_button_keydown_space_prevent_0_listener() {\n      const item_r5 = i0.ɵɵrestoreView(_r4).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onItemSelect(item_r5));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, TuiCalendarRangeComponent_ng_template_1_button_5_tui_svg_2_Template, 1, 1, \"tui-svg\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r5 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵattribute(\"aria-checked\", ctx_r1.isItemActive(item_r5));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", item_r5, \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isItemActive(item_r5));\n  }\n}\nfunction TuiCalendarRangeComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"tui-calendar\", 4);\n    i0.ɵɵpipe(2, \"tuiMapper\");\n    i0.ɵɵpipe(3, \"tuiMapper\");\n    i0.ɵɵlistener(\"dayClick\", function TuiCalendarRangeComponent_ng_template_1_Template_tui_calendar_dayClick_1_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onDayClick($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"tui-data-list\", 5);\n    i0.ɵɵtemplate(5, TuiCalendarRangeComponent_ng_template_1_button_5_Template, 3, 3, \"button\", 6);\n    i0.ɵɵpipe(6, \"async\");\n    i0.ɵɵpipe(7, \"tuiMapper\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabledItemHandler\", ctx_r1.calculatedDisabledItemHandler)(\"markerHandler\", ctx_r1.markerHandler)(\"max\", i0.ɵɵpipeBindV(2, 7, i0.ɵɵpureFunction4(28, _c0, ctx_r1.computedMax, ctx_r1.maxLengthMapper, ctx_r1.value, ctx_r1.maxLength)))(\"min\", i0.ɵɵpipeBindV(3, 13, i0.ɵɵpureFunction4(33, _c1, ctx_r1.computedMin, ctx_r1.maxLengthMapper, ctx_r1.value, ctx_r1.maxLength)))(\"month\", ctx_r1.computedMonth)(\"value\", ctx_r1.value);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBindV(7, 21, i0.ɵɵpureFunction6(38, _c2, ctx_r1.items, ctx_r1.mapper, ctx_r1.min, ctx_r1.max, ctx_r1.minLength, i0.ɵɵpipeBind1(6, 19, ctx_r1.otherDateText$))));\n  }\n}\nlet TuiCalendarRangeComponent = /*#__PURE__*/(() => {\n  class TuiCalendarRangeComponent {\n    constructor(valueChanges, cdr, destroy$, otherDateText$, icons) {\n      this.cdr = cdr;\n      this.otherDateText$ = otherDateText$;\n      this.icons = icons;\n      /**\n       * @deprecated use `item`\n       */\n      this.selectedPeriod = null;\n      this.defaultViewedMonth = TuiMonth.currentLocal();\n      this.disabledItemHandler = ALWAYS_FALSE_HANDLER;\n      this.markerHandler = TUI_DEFAULT_MARKER_HANDLER;\n      this.items = [];\n      this.min = TUI_FIRST_DAY;\n      this.max = TUI_LAST_DAY;\n      this.minLength = null;\n      this.maxLength = null;\n      this.value = null;\n      this.item = null;\n      this.valueChange = new EventEmitter();\n      this.itemChange = new EventEmitter();\n      this.previousValue = null;\n      this.maxLengthMapper = MAX_DAY_RANGE_LENGTH_MAPPER;\n      this.monthOffset = (value, month) => value.append({\n        month\n      });\n      this.mapper = (items, min, max, minLength, otherDateText) => [...items.filter(item => (minLength === null || item.range.from.append(minLength).daySameOrBefore(item.range.to)) && (min === null || item.range.to.daySameOrAfter(min)) && (max === null || item.range.from.daySameOrBefore(max))), otherDateText !== null && otherDateText !== void 0 ? otherDateText : ''];\n      if (!valueChanges) {\n        return;\n      }\n      valueChanges.pipe(tuiWatch(cdr), takeUntil(destroy$)).subscribe(value => {\n        this.value = value;\n      });\n    }\n    get computedMin() {\n      var _a;\n      return (_a = this.min) !== null && _a !== void 0 ? _a : TUI_FIRST_DAY;\n    }\n    get computedMax() {\n      var _a;\n      return (_a = this.max) !== null && _a !== void 0 ? _a : TUI_LAST_DAY;\n    }\n    /**\n     * @deprecated use `item`\n     */\n    get selectedActivePeriod() {\n      return this.selectedPeriod;\n    }\n    /**\n     * @deprecated use `item`\n     */\n    set selectedActivePeriod(period) {\n      this.selectedPeriod = period;\n    }\n    onEsc(event) {\n      var _a;\n      if (event.key !== 'Escape' || !((_a = this.value) === null || _a === void 0 ? void 0 : _a.isSingleDay)) {\n        return;\n      }\n      event.stopPropagation();\n      this.value = this.previousValue;\n    }\n    get calculatedDisabledItemHandler() {\n      return this.calculateDisabledItemHandler(this.disabledItemHandler, this.value, this.minLength);\n    }\n    get computedMonth() {\n      return this.value ? this.value.to : this.defaultViewedMonth;\n    }\n    isItemActive(item) {\n      const {\n        activePeriod\n      } = this;\n      return tuiIsString(item) && activePeriod === null || activePeriod === item || (activePeriod === null || activePeriod === void 0 ? void 0 : activePeriod.toString()) === item.toString();\n    }\n    // TODO: investigate if it is used anywhere and (if not) delete it in v4.0\n    onRangeChange(dayRange) {\n      this.updateValue(dayRange);\n    }\n    onDayClick(day) {\n      const {\n        value\n      } = this;\n      this.previousValue = value;\n      this.selectedActivePeriod = null;\n      if (value === null || !value.isSingleDay) {\n        this.value = new TuiDayRange(day, day);\n        this.itemChange.emit(this.findItemByDayRange(this.value));\n        return;\n      }\n      const sortedDayRange = TuiDayRange.sort(value.from, day);\n      this.updateValue(sortedDayRange);\n      this.itemChange.emit(this.findItemByDayRange(sortedDayRange));\n    }\n    onItemSelect(item) {\n      if (!tuiIsString(item)) {\n        this.selectedActivePeriod = item;\n        this.updateValue(item.range.dayLimit(this.min, this.max));\n        this.itemChange.emit(item);\n        return;\n      }\n      if (this.activePeriod !== null) {\n        this.selectedActivePeriod = null;\n        this.updateValue(null);\n        this.itemChange.emit(null);\n      }\n    }\n    updateValue(value) {\n      this.value = value;\n      this.valueChange.emit(value);\n    }\n    get activePeriod() {\n      var _a, _b;\n      return (_b = (_a = this.item) !== null && _a !== void 0 ? _a : this.selectedActivePeriod) !== null && _b !== void 0 ? _b : this.items.find(item => tuiNullableSame(this.value, item.range, (a, b) => a.from.daySame(b.from.dayLimit(this.min, this.max)) && a.to.daySame(b.to.dayLimit(this.min, this.max)))) || null;\n    }\n    calculateDisabledItemHandler(disabledItemHandler, value, minLength) {\n      return item => {\n        if (!(value === null || value === void 0 ? void 0 : value.isSingleDay) || !minLength) {\n          return disabledItemHandler(item);\n        }\n        const negativeMinLength = tuiObjectFromEntries(Object.entries(minLength).map(([key, value]) => [key, -value]));\n        const disabledBefore = value.from.append(negativeMinLength).append({\n          day: 1\n        });\n        const disabledAfter = value.from.append(minLength).append({\n          day: -1\n        });\n        const inDisabledRange = disabledBefore.dayBefore(item) && disabledAfter.dayAfter(item);\n        return inDisabledRange || disabledItemHandler(item);\n      };\n    }\n    findItemByDayRange(dayRange) {\n      var _a;\n      return (_a = this.items.find(item => dayRange.daySame(item.range))) !== null && _a !== void 0 ? _a : null;\n    }\n  }\n  TuiCalendarRangeComponent.ɵfac = function TuiCalendarRangeComponent_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || TuiCalendarRangeComponent)(i0.ɵɵdirectiveInject(TUI_CALENDAR_DATE_STREAM, 8), i0.ɵɵdirectiveInject(ChangeDetectorRef), i0.ɵɵdirectiveInject(TuiDestroyService, 2), i0.ɵɵdirectiveInject(TUI_OTHER_DATE_TEXT), i0.ɵɵdirectiveInject(TUI_COMMON_ICONS));\n  };\n  TuiCalendarRangeComponent.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n    type: TuiCalendarRangeComponent,\n    selectors: [[\"tui-calendar-range\"]],\n    hostBindings: function TuiCalendarRangeComponent_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"keydown.capture\", function TuiCalendarRangeComponent_keydown_capture_HostBindingHandler($event) {\n          return ctx.onEsc($event);\n        }, i0.ɵɵresolveDocument);\n      }\n    },\n    inputs: {\n      defaultViewedMonth: \"defaultViewedMonth\",\n      disabledItemHandler: \"disabledItemHandler\",\n      markerHandler: \"markerHandler\",\n      items: \"items\",\n      min: \"min\",\n      max: \"max\",\n      minLength: \"minLength\",\n      maxLength: \"maxLength\",\n      value: \"value\",\n      item: \"item\"\n    },\n    outputs: {\n      valueChange: \"valueChange\",\n      itemChange: \"itemChange\"\n    },\n    standalone: false,\n    features: [i0.ɵɵProvidersFeature([TuiDestroyService])],\n    decls: 3,\n    vars: 2,\n    consts: [[\"presets\", \"\"], [\"automation-id\", \"tui-calendar-range__calendars\", \"tuiPreventDefault\", \"mousedown\", 3, \"defaultViewedMonthFirst\", \"defaultViewedMonthSecond\", \"disabledItemHandler\", \"markerHandler\", \"max\", \"min\", \"value\", \"dayClick\", 4, \"ngIf\", \"ngIfElse\"], [\"automation-id\", \"tui-calendar-range__calendars\", \"tuiPreventDefault\", \"mousedown\", 3, \"dayClick\", \"defaultViewedMonthFirst\", \"defaultViewedMonthSecond\", \"disabledItemHandler\", \"markerHandler\", \"max\", \"min\", \"value\"], [1, \"t-wrapper\"], [\"automation-id\", \"tui-calendar-range__calendar\", \"tuiPreventDefault\", \"mousedown\", 3, \"dayClick\", \"disabledItemHandler\", \"markerHandler\", \"max\", \"min\", \"month\", \"value\"], [\"automation-id\", \"tui-calendar-range__menu\", \"role\", \"menu\", 1, \"t-menu\"], [\"automation-id\", \"tui-calendar-range__menu__item\", \"role\", \"menuitemradio\", \"tuiOption\", \"\", \"tuiPreventDefault\", \"mousedown\", 3, \"click\", \"keydown.enter.prevent\", \"keydown.space.prevent\", 4, \"ngFor\", \"ngForOf\"], [\"automation-id\", \"tui-calendar-range__menu__item\", \"role\", \"menuitemradio\", \"tuiOption\", \"\", \"tuiPreventDefault\", \"mousedown\", 3, \"click\", \"keydown.enter.prevent\", \"keydown.space.prevent\"], [\"automation-id\", \"tui-calendar-range__checkmark\", \"class\", \"t-checkmark\", 3, \"src\", 4, \"ngIf\"], [\"automation-id\", \"tui-calendar-range__checkmark\", 1, \"t-checkmark\", 3, \"src\"]],\n    template: function TuiCalendarRangeComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, TuiCalendarRangeComponent_tui_primitive_calendar_range_0_Template, 4, 33, \"tui-primitive-calendar-range\", 1)(1, TuiCalendarRangeComponent_ng_template_1_Template, 8, 45, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        const presets_r6 = i0.ɵɵreference(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.items.length)(\"ngIfElse\", presets_r6);\n      }\n    },\n    dependencies: [i1.TuiPrimitiveCalendarRangeComponent, i2.TuiCalendarComponent, i2.TuiDataListComponent, i2.TuiOptionComponent, i2.TuiSvgComponent, i3.NgIf, i4.TuiPreventDefaultDirective, i3.NgForOf, i4.TuiMapperPipe, i3.AsyncPipe],\n    styles: [\"[_nghost-%COMP%]{display:block}.t-wrapper[_ngcontent-%COMP%]{display:flex}.t-menu[_ngcontent-%COMP%]{width:11rem;border-left:1px solid var(--tui-base-03)}.t-checkmark[_ngcontent-%COMP%]{margin-left:auto;width:1rem;height:1rem}\"],\n    changeDetection: 0\n  });\n  __decorate([tuiPure], TuiCalendarRangeComponent.prototype, \"calculateDisabledItemHandler\", null);\n  return TuiCalendarRangeComponent;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet TuiCalendarRangeModule = /*#__PURE__*/(() => {\n  class TuiCalendarRangeModule {}\n  TuiCalendarRangeModule.ɵfac = function TuiCalendarRangeModule_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || TuiCalendarRangeModule)();\n  };\n  TuiCalendarRangeModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n    type: TuiCalendarRangeModule\n  });\n  TuiCalendarRangeModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n    imports: [[CommonModule, TuiMapperPipeModule, TuiPreventDefaultModule, TuiCalendarModule, TuiCalendarModule, TuiSvgModule, TuiDataListModule, TuiPrimitiveCalendarRangeModule]]\n  });\n  return TuiCalendarRangeModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { TuiCalendarRangeComponent, TuiCalendarRangeModule };\n//# sourceMappingURL=taiga-ui-kit-components-calendar-range.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}